---
interface Props {
  title: string;
  url: string;
}

const { title, url } = Astro.props;

// エンコードされたURL/タイトル
const encodedUrl = encodeURIComponent(url);
const encodedTitle = encodeURIComponent(title);
---

<div class="share-buttons">
  <h3 class="share-title">このゲームをシェア</h3>
  <div class="share-button-group">
    <!-- Twitter/X -->
    <a
      href={`https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`}
      target="_blank"
      rel="noopener noreferrer"
      class="share-btn share-btn-x"
      aria-label="Xでシェア"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
      </svg>
      <span>X</span>
    </a>

    <!-- LINE -->
    <a
      href={`https://social-plugins.line.me/lineit/share?url=${encodedUrl}`}
      target="_blank"
      rel="noopener noreferrer"
      class="share-btn share-btn-line"
      aria-label="LINEでシェア"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
      </svg>
      <span>LINE</span>
    </a>

    <!-- URLコピー -->
    <button
      type="button"
      class="share-btn share-btn-copy"
      data-url={url}
      aria-label="URLをコピー"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
      <span class="copy-text">コピー</span>
    </button>
  </div>
</div>

<script>
  // URLコピー機能
  document.addEventListener('DOMContentLoaded', () => {
    const copyButtons = document.querySelectorAll('.share-btn-copy');

    copyButtons.forEach(button => {
      button.addEventListener('click', async () => {
        const url = button.getAttribute('data-url');
        const copyText = button.querySelector('.copy-text');

        if (!url || !copyText) return;

        try {
          await navigator.clipboard.writeText(url);
          const originalText = copyText.textContent;
          copyText.textContent = 'コピー済み!';

          setTimeout(() => {
            copyText.textContent = originalText;
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
          copyText.textContent = 'エラー';

          setTimeout(() => {
            copyText.textContent = 'コピー';
          }, 2000);
        }
      });
    });
  });
</script>

<style>
  .share-buttons {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 1.5rem;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
  }

  .share-title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0 0 1rem 0;
    color: var(--text);
  }

  .share-button-group {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .share-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: inherit;
  }

  .share-btn svg {
    flex-shrink: 0;
  }

  .share-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  }

  /* X（Twitter）ボタン */
  .share-btn-x {
    background: #000000;
    color: white;
  }

  .share-btn-x:hover {
    background: #1a1a1a;
  }

  /* LINEボタン */
  .share-btn-line {
    background: #06C755;
    color: white;
  }

  .share-btn-line:hover {
    background: #05b04d;
  }

  /* コピーボタン */
  .share-btn-copy {
    background: rgba(156, 163, 175, 0.2);
    color: var(--text-muted);
    border: 1px solid rgba(156, 163, 175, 0.3);
  }

  .share-btn-copy:hover {
    background: rgba(156, 163, 175, 0.3);
    color: var(--text);
  }

  /* レスポンシブ: モバイルは縦積み */
  @media (max-width: 480px) {
    .share-button-group {
      flex-direction: column;
    }

    .share-btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>
