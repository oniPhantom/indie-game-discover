---
import { getCollection } from 'astro:content';
import GameLayout from '../layouts/GameLayout.astro';
import GameListItem from '../components/GameListItem.astro';

const games = (await getCollection('games')).sort(
  (a, b) => new Date(b.data.generatedAt).getTime() - new Date(a.data.generatedAt).getTime()
);

// ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ã‚°ã‚’æŠ½å‡º
const allGenres = [...new Set(games.flatMap(game => game.data.genres))].sort();
---

<GameLayout title="ãƒ›ãƒ¼ãƒ ">
  {games.length === 0 ? (
    <p class="empty">ã¾ã è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“ã€‚`npm run generate` ã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚</p>
  ) : (
    <section class="games-section">
      <h2>ğŸ® ã‚²ãƒ¼ãƒ ä¸€è¦§</h2>

      {/* ã‚¸ãƒ£ãƒ³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ */}
      <div class="filter-bar">
        <button class="filter-btn active" data-genre="all">ã™ã¹ã¦</button>
        {allGenres.map(genre => (
          <button class="filter-btn" data-genre={genre}>{genre}</button>
        ))}
      </div>

      <div class="game-list" role="list" aria-label="ã‚²ãƒ¼ãƒ ä¸€è¦§">
        {games.map((game) => (
          <div class="game-item" data-genres={game.data.genres.join(',')}>
            <GameListItem
              slug={game.id}
              title={game.data.title}
              headerImage={game.data.headerImage}
              genres={game.data.genres}
              price={game.data.price}
              developer={game.data.developer}
              reviewScore={game.data.reviewScore}
              reviewPercentage={game.data.reviewPercentage}
              kansaiCatch={game.data.kansaiCatch}
            />
          </div>
        ))}
      </div>
    </section>
  )}
</GameLayout>

<script>
  // ã‚¸ãƒ£ãƒ³ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½
  const filterButtons = document.querySelectorAll('.filter-btn');
  const gameItems = document.querySelectorAll('.game-item');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const selectedGenre = button.getAttribute('data-genre');

      // activeã‚¯ãƒ©ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆ
      filterButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      // ã‚²ãƒ¼ãƒ ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
      gameItems.forEach(item => {
        const itemGenres = item.getAttribute('data-genres');

        if (selectedGenre === 'all' || itemGenres.includes(selectedGenre)) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    });
  });
</script>

<style>
  /* ã‚²ãƒ¼ãƒ ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
  .games-section {
    max-width: 1200px;
    margin: 3rem auto;
    padding: 0 1rem;
  }

  .games-section h2 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 3px solid var(--accent);
  }

  /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼ */
  .filter-bar {
    display: flex;
    gap: 0.75rem;
    margin-top: 1.5rem;
    padding: 0.5rem 0;
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--accent) var(--card-bg);
  }

  .filter-bar::-webkit-scrollbar {
    height: 6px;
  }

  .filter-bar::-webkit-scrollbar-track {
    background: var(--card-bg);
    border-radius: 3px;
  }

  .filter-bar::-webkit-scrollbar-thumb {
    background: var(--accent);
    border-radius: 3px;
  }

  .filter-btn {
    flex-shrink: 0;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    background: rgba(124, 58, 237, 0.15);
    color: var(--text);
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-btn:hover {
    background: rgba(124, 58, 237, 0.25);
    border-color: rgba(124, 58, 237, 0.5);
  }

  .filter-btn.active {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  /* ãƒªã‚¹ãƒˆï¼ˆç¸¦ä¸¦ã³ï¼‰ */
  .game-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .game-item {
    display: flex;
  }

  /* 0ä»¶æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ */
  .empty {
    text-align: center;
    padding: 4rem 1rem;
    font-size: 1.2rem;
  }

  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ */
  @media (max-width: 768px) {
    .games-section h2 {
      font-size: 1.5rem;
    }

    .filter-bar {
      gap: 0.5rem;
      padding: 0.25rem 0;
    }

    .filter-btn {
      font-size: 0.8rem;
      padding: 0.4rem 0.875rem;
    }
  }
</style>
